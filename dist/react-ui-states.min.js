!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("react-ui-states",[],t):"object"==typeof exports?exports["react-ui-states"]=t():e["react-ui-states"]=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);Object.defineProperty(t,"Utils",{enumerable:!0,get:function(){return r(i).default}});var o=n(4);Object.defineProperty(t,"DefaultStore",{enumerable:!0,get:function(){return r(o).default}});var a=n(7);Object.defineProperty(t,"UIStore",{enumerable:!0,get:function(){return r(a).default}});var u=n(8);Object.defineProperty(t,"BaseUIState",{enumerable:!0,get:function(){return r(u).default}});var l=n(9);Object.defineProperty(t,"DefaultUIState",{enumerable:!0,get:function(){return r(l).default}});var s=n(5);Object.defineProperty(t,"objectPath",{enumerable:!0,get:function(){return r(s).default}})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=r(i),a=n(3),u=r(a),l={Other:o.default,Array:u.default};t.default=l},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){n(this,e)}return r(e,null,[{key:"isExist",value:function(e){return e===!0||e===!1||(0===e||!!e)}},{key:"deepClone",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"createGuid",value:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}]),e}();t.default=i},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){n(this,e)}return r(e,null,[{key:"removeAt",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?1:arguments[2];e.splice(t,n)}}]),e}();t.default=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(1),u=r(a),l=n(5),s=r(l),f=function(){function e(t){i(this,e),this._key=t,this._model={_lastUpdateTime:Date.now(),_isNew:null,_isExist:!1},this._subscribers=[],this._subscribersOnFieldUpdate=[]}return o(e,[{key:"createNew",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this._model=e,this._model._lastUpdateTime=Date.now(),this._model._isNew=!0,this._model._isExist=!0,this._publish()}},{key:"replace",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this._model=e,this._model._lastUpdateTime=Date.now(),this._model._isNew=!1,this._model._isExist=!0,this._publish()}},{key:"clear",value:function(){this._model={_lastUpdateTime:Date.now(),_isNew:null,_isExist:!1},this._publish()}},{key:"update",value:function(e,t,n){u.default.Other.isExist(t)||(this._model._isNew=!1,Object.assign(this._model,e)),this._model._lastUpdateTime=Date.now(),this._model._isExist=!0,this._publish(t,n)}},{key:"updateField",value:function(e,t,n,r){u.default.Other.isExist(t)||s.default.set(this._model,n,e),this._model._lastUpdateTime=Date.now(),this._publishByPath(n,e,t,r)}},{key:"clearValidationInField",value:function(e){this.updateField(s.default.get(this._model,e),null,e)}},{key:"isExist",value:function(){return this.getModel()._isExist}},{key:"getModel",value:function(){return this._model}},{key:"getModelClone",value:function(){return u.default.Other.deepClone(this.getModel())}},{key:"getDataByPath",value:function(e){var t=s.default.get(this._model,e);return t||""}},{key:"getDataCloneByPath",value:function(e){return u.default.Other.deepClone(this.getDataByPath(e))}},{key:"subscribe",value:function(e,t){this._subscribe(e,t,"_subscribers")}},{key:"subscribeOnFieldUpdate",value:function(e,t){this._subscribe(e,t,"_subscribersOnFieldUpdate")}},{key:"unSubscribe",value:function(e){var t=this._subscribers.findIndex(function(t){return t.id===e});u.default.Array.removeAt(this._subscribers,t),t=this._subscribersOnFieldUpdate.findIndex(function(t){return t.id===e}),u.default.Array.removeAt(this._subscribersOnFieldUpdate,t)}},{key:"_publish",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=this._subscribers[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var u=o.value;u.action(this.key,this._model,e,t)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}},{key:"_subscribe",value:function(e,t,n){var r=this[n].findIndex(function(t){return t.id===e});r===-1?this[n].push({id:e,action:t}):console.warn("state with id = "+e+"already added")}},{key:"_publishByPath",value:function(e,t,n,r){var i=!0,o=!1,a=void 0;try{for(var u,l=this._subscribersOnFieldUpdate[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var s=u.value;s.action(this.key,e,t,n,r)}}catch(e){o=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw a}}}},{key:"key",get:function(){return this._key}}]),e}();t.default=f},function(e,t,n){var r,i,o;(function(e){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(a,u){"object"===n(e)&&"object"===n(e.exports)?e.exports=u():(i=[],r=u,o="function"==typeof r?r.apply(t,i):r,!(void 0!==o&&(e.exports=o)))}(void 0,function(){function e(e){if(!e)return!0;if(d(e)&&0===e.length)return!0;if(!i(e)){for(var t in e)if(c.call(e,t))return!1;return!0}return!1}function t(e){return f.call(e)}function r(e){return"number"==typeof e||"[object Number]"===t(e)}function i(e){return"string"==typeof e||"[object String]"===t(e)}function o(e){return"object"===("undefined"==typeof e?"undefined":n(e))&&"[object Object]"===t(e)}function a(e){return"boolean"==typeof e||"[object Boolean]"===t(e)}function u(e){var t=parseInt(e);return t.toString()===e?t:e}function l(t,n,o,a){if(r(n)&&(n=[n]),e(n))return t;if(i(n))return l(t,n.split(".").map(u),o,a);var s=n[0];if(1===n.length){var f=t[s];return void 0!==f&&a||(t[s]=o),f}return void 0===t[s]&&(r(n[1])?t[s]=[]:t[s]={}),l(t[s],n.slice(1),o,a)}function s(t,n){if(r(n)&&(n=[n]),!e(t)){if(e(n))return t;if(i(n))return s(t,n.split("."));var o=u(n[0]),a=t[o];if(1===n.length)void 0!==a&&(d(t)?t.splice(o,1):delete t[o]);else if(void 0!==t[o])return s(t[o],n.slice(1));return t}}var f=Object.prototype.toString,c=Object.prototype.hasOwnProperty,d=Array.isArray||function(e){return"[object Array]"===f.call(e)},h=function e(t){return Object.keys(e).reduce(function(n,r){return"function"==typeof e[r]&&(n[r]=e[r].bind(e,t)),n},{})};return h.has=function(t,n){if(e(t))return!1;if(r(n)?n=[n]:i(n)&&(n=n.split(".")),e(n)||0===n.length)return!1;for(var a=0;a<n.length;a++){var u=n[a];if(!o(t)&&!d(t)||!c.call(t,u))return!1;t=t[u]}return!0},h.ensureExists=function(e,t,n){return l(e,t,n,!0)},h.set=function(e,t,n,r){return l(e,t,n,r)},h.insert=function(e,t,n,r){var i=h.get(e,t);r=~~r,d(i)||(i=[],h.set(e,t,i)),i.splice(r,0,n)},h.empty=function(t,n){if(e(n))return t;if(!e(t)){var u,l;if(!(u=h.get(t,n)))return t;if(i(u))return h.set(t,n,"");if(a(u))return h.set(t,n,!1);if(r(u))return h.set(t,n,0);if(d(u))u.length=0;else{if(!o(u))return h.set(t,n,null);for(l in u)c.call(u,l)&&delete u[l]}}},h.push=function(e,t){var n=h.get(e,t);d(n)||(n=[],h.set(e,t,n)),n.push.apply(n,Array.prototype.slice.call(arguments,2))},h.coalesce=function(e,t,n){for(var r,i=0,o=t.length;i<o;i++)if(void 0!==(r=h.get(e,t[i])))return r;return n},h.get=function(t,n,o){if(r(n)&&(n=[n]),e(n))return t;if(e(t))return o;if(i(n))return h.get(t,n.split("."),o);var a=u(n[0]);return 1===n.length?void 0===t[a]?o:t[a]:h.get(t[a],n.slice(1),o)},h.del=function(e,t){return s(e,t)},h})}).call(t,n(6)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(1),u=r(a),l=function(){function e(){i(this,e)}return o(e,null,[{key:"addState",value:function(t){e._states.push(t)}},{key:"removeState",value:function(t){var n=e._states.findIndex(function(e){return e.id===t});n>-1&&u.default.Array.removeAt(e._states,n)}}]),e}();l._states=[],t.default=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){var n=t;return f.default.Other.isExist(e)&&(n=e+"."+t),n}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.getFullPath=o;var u=n(7),l=r(u),s=n(1),f=r(s),c=n(5),d=r(c),h=function(){function e(){i(this,e),this.id=f.default.Other.createGuid(),l.default.addState(this)}return a(e,[{key:"set",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]||arguments[2];d.default.has(this,e)||console.info("created path: "+e),d.default.set(this,e,t),n===!0&&this._updateComponent()}},{key:"has",value:function(e){return d.default.has(this,e)}},{key:"get",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return d.default.get(this,e,t)}},{key:"removeState",value:function(){l.default.removeState(this.id)}},{key:"_updateComponent",value:function(){}}]),e}();t.default=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},s=n(5),f=r(s),c=n(1),d=r(c),h=n(8),v=r(h),y=function(e){function t(e,n){var r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];i(this,t);var a=o(this,Object.getPrototypeOf(t).call(this));a._onUpdateStore=a._onUpdateStore.bind(a),a._onUpdateStoreField=a._onUpdateStoreField.bind(a),a._component=e,a._storesParams=r;var u=!0,l=!1,s=void 0;try{for(var f,c=a._storesParams[Symbol.iterator]();!(u=(f=c.next()).done);u=!0){var d=f.value;d.cloneStore=d.cloneStore||!0,d.dataConvertFunc=d.dataConvertFunc||function(e){return e},d.updateCondition=d.updateCondition||function(){return!0},d.updateFieldCondition=d.updateFieldCondition||function(){return!0}}}catch(e){l=!0,s=e}finally{try{!u&&c.return&&c.return()}finally{if(l)throw s}}a.model=n||{},a._startedModel=n||{},a._updatingStore=null,a._updatingFieldPath=null;var h=a._validateParams(a._storesParams);return h&&(a._subscribeToStores(r),a._setStoreModels()),a}return a(t,e),u(t,[{key:"cancelAllChanges",value:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];this.cancelModelChanges();var t=!0,n=!1,r=void 0;try{for(var i,o=this._storesParams[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this._setStoreModel(a.store.key,null,!0),e===!0&&(this[a.store.key].validationData={})}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}this._updateComponent()}},{key:"cancelModelChanges",value:function(){this.model=d.default.Other.deepClone(this._startedModel)}},{key:"cancelStoresChanges",value:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=!(arguments.length<=2||void 0===arguments[2])&&arguments[2],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var l=a.value;n===!1&&this._setStoreModel(l,null,!0),t===!0&&(this[l].validationData={})}}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}this._updateComponent()}},{key:"cancelChangesByPath",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]||arguments[2],r=t.key+"."+e;if(f.default.has(this,r)){var i=this._getStoreDataByPath(t.key,e);f.default.set(this,r,i);var o="validationData."+e,a=t.key+"."+o;f.default.has(this,a)&&(i=this._getStoreDataByPath(t.key,o),f.default.set(this,a,i))}else console.log("path "+r+" not found");n===!0&&this._updateComponent()}},{key:"removeState",value:function(){l(Object.getPrototypeOf(t.prototype),"removeState",this).call(this);var e=!0,n=!1,r=void 0;try{for(var i,o=this._storesParams[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;a.store.unSubscribe(this.id)}}catch(e){n=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"getLastStoreUpdateTime",value:function(e){return this[e]._lastUpdateTime}},{key:"storeModelIsNew",value:function(e){return this[e]._isNew}},{key:"storeModelIsExist",value:function(e){return this[e]._isExist}},{key:"_setStoreModels",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this._storesParams[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;this._setStoreModel(o.store.key)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},{key:"_setStoreModel",value:function(e,t){var n=!(arguments.length<=2||void 0===arguments[2])&&arguments[2],r=this._getStoreModel(e);n!==!0&&d.default.Other.isExist(t)?(this[e].validationData=t,this[e]._lastUpdateTime=r._lastUpdateTime):this[e]=r}},{key:"_getStoreModel",value:function(e){var t=this._getParamByStoreKey(e),n=t.cloneStore===!0?t.store.getModelClone():t.store.getModel();return n}},{key:"_getStoreDataByPath",value:function(e,t){var n=this._getParamByStoreKey(e),r=n.cloneStore===!0?n.store.getDataCloneByPath(t):n.store.getDataByPath(t);return r}},{key:"_validateParams",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(!d.default.Other.isExist(a.store))return console.error("param.store is empty in component "+this._component.constructor.name),!1}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}return!0}},{key:"_subscribeToStores",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;a.store.subscribe(this.id,this._onUpdateStore),a.store.subscribeOnFieldUpdate(this.id,this._onUpdateStoreField)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"_onUpdateStore",value:function(e,t,n,r){var i=this._getParamByStoreKey(e);i.updateCondition(t)!==!1&&(this._setStoreModel(e,n),d.default.Other.isExist(r)&&r.doUpdateUIState===!1||this._updateComponent(e))}},{key:"_onUpdateStoreField",value:function(e,t,n,r,i){var o=this._getParamByStoreKey(e);if(o.updateFieldCondition(n)!==!1){d.default.Other.isExist(r)?(f.default.has(this[e].validationData,t)||(this[e].validationData={}),f.default.set(this[e].validationData,t,r)):(f.default.set(this[e],t,n),d.default.Other.isExist(this[e].validationData)&&(f.default.set(this[e].validationData,t,void 0),0===Object.keys(this[e].validationData).length&&(this[e].validationData=void 0)));var a=(0,h.getFullPath)(e,t);this._updateField(a)}}},{key:"_getParamByStoreKey",value:function(e){return this._storesParams.find(function(t){return t.store.key==e})}},{key:"_updateField",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?null:arguments[0];this._updatingFieldPath=t,this._component.forceUpdate(function(){e._updatingFieldPath=null})}},{key:"_updateComponent",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?null:arguments[0];this._updatingStore=t,this._component.forceUpdate(function(){e._updatingStore=null})}}]),t}(v.default);t.default=y}])});