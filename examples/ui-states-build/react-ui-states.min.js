!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("react-ui-states",[],e):"object"==typeof exports?exports["react-ui-states"]=e():t["react-ui-states"]=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(1);Object.defineProperty(e,"Utils",{enumerable:!0,get:function(){return r(i).default}});var a=n(4);Object.defineProperty(e,"DefaultStore",{enumerable:!0,get:function(){return r(a).default}});var o=n(7);Object.defineProperty(e,"UIStore",{enumerable:!0,get:function(){return r(o).default}});var u=n(8);Object.defineProperty(e,"BaseUIState",{enumerable:!0,get:function(){return r(u).default}});var l=n(9);Object.defineProperty(e,"DefaultUIState",{enumerable:!0,get:function(){return r(l).default}});var s=n(5);Object.defineProperty(e,"objectPath",{enumerable:!0,get:function(){return r(s).default}})},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),a=r(i),o=n(3),u=r(o),l={Other:a.default,Array:u.default};e.default=l},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(){n(this,t)}return r(t,null,[{key:"isExist",value:function(t){return t===!0||t===!1||(0===t||!!t)}},{key:"deepClone",value:function(t){return JSON.parse(JSON.stringify(t))}},{key:"createGuid",value:function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}}]),t}();e.default=i},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(){n(this,t)}return r(t,null,[{key:"removeAt",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?1:arguments[2];t.splice(e,n)}}]),t}();e.default=i},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(1),u=r(o),l=n(5),s=r(l),f=function(){function t(e){i(this,t),this._key=e,this._model={validationData:null,_lastUpdateTime:Date.now(),_isNew:null,_isExist:!1},this._subscribers=[],this._subscribersOnFieldUpdate=[]}return a(t,[{key:"createNew",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this._model=t,this._model.validationData=null,this._model._lastUpdateTime=Date.now(),this._model._isNew=!0,this._model._isExist=!0,this._publish()}},{key:"replace",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this._model=t,this._model.validationData=null,this._model._lastUpdateTime=Date.now(),this._model._isNew=!1,this._model._isExist=!0,this._publish()}},{key:"clear",value:function(){this._model={validationData:null,_lastUpdateTime:Date.now(),_isNew:null,_isExist:!1},this._publish()}},{key:"update",value:function(t,e,n){u.default.Other.isExist(e)||(this._model._isNew=!1,Object.assign(this._model,t)),this._model.validationData=e,this._model._lastUpdateTime=Date.now(),this._model._isExist=!0,this._publish(n)}},{key:"updateField",value:function(t,e,n){u.default.Other.isExist(e)?(u.default.Other.isExist(this._model.validationData)||(this._model.validationData={}),s.default.set(this._model.validationData,n,e)):s.default.set(this._model,n,t),this._model._lastUpdateTime=Date.now(),this._publishByPath(n,t,e)}},{key:"clearValidationInField",value:function(t){this.updateField(s.default.get(this._model,t),null,t)}},{key:"isExist",value:function(){return this.getModel()._isExist}},{key:"getModel",value:function(){return this._model}},{key:"getModelClone",value:function(){return u.default.Other.deepClone(this.getModel())}},{key:"getDataByPath",value:function(t){var e=s.default.get(this._model,t);return e||""}},{key:"getDataCloneByPath",value:function(t){return u.default.Other.deepClone(this.getDataByPath(t))}},{key:"subscribe",value:function(t,e){this._subscribe(t,e,"_subscribers")}},{key:"subscribeOnFieldUpdate",value:function(t,e){this._subscribe(t,e,"_subscribersOnFieldUpdate")}},{key:"unSubscribe",value:function(t){var e=this._subscribers.findIndex(function(e){return e.id===t});u.default.Array.removeAt(this._subscribers,e),e=this._subscribersOnFieldUpdate.findIndex(function(e){return e.id===t}),u.default.Array.removeAt(this._subscribersOnFieldUpdate,e)}},{key:"_publish",value:function(t){var e=!0,n=!1,r=void 0;try{for(var i,a=this._subscribers[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;o.action(this.key,this._model,t)}}catch(t){n=!0,r=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw r}}}},{key:"_subscribe",value:function(t,e,n){var r=this[n].findIndex(function(e){return e.id===t});r===-1?this[n].push({id:t,action:e}):console.warn("state with id = "+t+"already added")}},{key:"_publishByPath",value:function(t,e,n){var r=!0,i=!1,a=void 0;try{for(var o,u=this._subscribersOnFieldUpdate[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var l=o.value;l.action(this.key,t,e,n)}}catch(t){i=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}}},{key:"key",get:function(){return this._key}}]),t}();e.default=f},function(t,e,n){var r,i,a;(function(t){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(o,u){"object"===n(t)&&"object"===n(t.exports)?t.exports=u():(i=[],r=u,a="function"==typeof r?r.apply(e,i):r,!(void 0!==a&&(t.exports=a)))}(void 0,function(){function t(t){if(!t)return!0;if(d(t)&&0===t.length)return!0;if(!i(t)){for(var e in t)if(c.call(t,e))return!1;return!0}return!1}function e(t){return f.call(t)}function r(t){return"number"==typeof t||"[object Number]"===e(t)}function i(t){return"string"==typeof t||"[object String]"===e(t)}function a(t){return"object"===("undefined"==typeof t?"undefined":n(t))&&"[object Object]"===e(t)}function o(t){return"boolean"==typeof t||"[object Boolean]"===e(t)}function u(t){var e=parseInt(t);return e.toString()===t?e:t}function l(e,n,a,o){if(r(n)&&(n=[n]),t(n))return e;if(i(n))return l(e,n.split(".").map(u),a,o);var s=n[0];if(1===n.length){var f=e[s];return void 0!==f&&o||(e[s]=a),f}return void 0===e[s]&&(r(n[1])?e[s]=[]:e[s]={}),l(e[s],n.slice(1),a,o)}function s(e,n){if(r(n)&&(n=[n]),!t(e)){if(t(n))return e;if(i(n))return s(e,n.split("."));var a=u(n[0]),o=e[a];if(1===n.length)void 0!==o&&(d(e)?e.splice(a,1):delete e[a]);else if(void 0!==e[a])return s(e[a],n.slice(1));return e}}var f=Object.prototype.toString,c=Object.prototype.hasOwnProperty,d=Array.isArray||function(t){return"[object Array]"===f.call(t)},h=function t(e){return Object.keys(t).reduce(function(n,r){return"function"==typeof t[r]&&(n[r]=t[r].bind(t,e)),n},{})};return h.has=function(e,n){if(t(e))return!1;if(r(n)?n=[n]:i(n)&&(n=n.split(".")),t(n)||0===n.length)return!1;for(var o=0;o<n.length;o++){var u=n[o];if(!a(e)&&!d(e)||!c.call(e,u))return!1;e=e[u]}return!0},h.ensureExists=function(t,e,n){return l(t,e,n,!0)},h.set=function(t,e,n,r){return l(t,e,n,r)},h.insert=function(t,e,n,r){var i=h.get(t,e);r=~~r,d(i)||(i=[],h.set(t,e,i)),i.splice(r,0,n)},h.empty=function(e,n){if(t(n))return e;if(!t(e)){var u,l;if(!(u=h.get(e,n)))return e;if(i(u))return h.set(e,n,"");if(o(u))return h.set(e,n,!1);if(r(u))return h.set(e,n,0);if(d(u))u.length=0;else{if(!a(u))return h.set(e,n,null);for(l in u)c.call(u,l)&&delete u[l]}}},h.push=function(t,e){var n=h.get(t,e);d(n)||(n=[],h.set(t,e,n)),n.push.apply(n,Array.prototype.slice.call(arguments,2))},h.coalesce=function(t,e,n){for(var r,i=0,a=e.length;i<a;i++)if(void 0!==(r=h.get(t,e[i])))return r;return n},h.get=function(e,n,a){if(r(n)&&(n=[n]),t(n))return e;if(t(e))return a;if(i(n))return h.get(e,n.split("."),a);var o=u(n[0]);return 1===n.length?void 0===e[o]?a:e[o]:h.get(e[o],n.slice(1),a)},h.del=function(t,e){return s(t,e)},h})}).call(e,n(6)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(1),u=r(o),l=function(){function t(){i(this,t)}return a(t,null,[{key:"addState",value:function(e){t._states.push(e)}},{key:"removeState",value:function(e){var n=t._states.findIndex(function(t){return t.id===e});n>-1&&u.default.Array.removeAt(t._states,n)}}]),t}();l._states=[],e.default=l},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){var n=e;return f.default.Other.isExist(t)&&(n=t+"."+e),n}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();e.getFullPath=a;var u=n(7),l=r(u),s=n(1),f=r(s),c=n(5),d=r(c),h=function(){function t(){i(this,t),this.id=f.default.Other.createGuid(),l.default.addState(this)}return o(t,[{key:"set",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]||arguments[2];d.default.has(this,t)||console.info("created path: "+t),d.default.set(this,t,e),n===!0&&this._updateComponent()}},{key:"has",value:function(t){return d.default.has(this,t)}},{key:"get",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return d.default.get(this,t,e)}},{key:"removeState",value:function(){l.default.removeState(this.id)}}]),t}();e.default=h},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,n,r)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(r)},s=n(5),f=r(s),c=n(1),d=r(c),h=n(8),v=r(h),y=function(t){function e(t,n){var r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];i(this,e);var o=a(this,Object.getPrototypeOf(e).call(this));o._onUpdateStore=o._onUpdateStore.bind(o),o._onUpdateStoreField=o._onUpdateStoreField.bind(o),o._component=t,o._storesParams=r;var u=!0,l=!1,s=void 0;try{for(var f,c=o._storesParams[Symbol.iterator]();!(u=(f=c.next()).done);u=!0){var d=f.value;d.cloneStore=d.cloneStore||!0,d.dataConvertFunc=d.dataConvertFunc||function(t){return t},d.updateCondition=d.updateCondition||function(){return!0},d.updateFieldCondition=d.updateFieldCondition||function(){return!0}}}catch(t){l=!0,s=t}finally{try{!u&&c.return&&c.return()}finally{if(l)throw s}}o.model=n||{},o._startedModel=n||{},o._updatingStore=null,o._updatingFieldPath=null;var h=o._validateParams(o._storesParams);return h&&(o._subscribeToStores(r),o._setStoreModels()),o}return o(e,t),u(e,[{key:"cancelAllChanges",value:function(){var t=arguments.length<=0||void 0===arguments[0]||arguments[0];this.cancelModelChanges();var e=!0,n=!1,r=void 0;try{for(var i,a=this._storesParams[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;this._setStoreModel(o.store.key,!0),t===!0&&(this[o.store.key].validationData={})}}catch(t){n=!0,r=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw r}}this._updateComponent()}},{key:"cancelModelChanges",value:function(){this.model=d.default.Other.deepClone(this._startedModel)}},{key:"cancelStoresChanges",value:function(t){var e=arguments.length<=1||void 0===arguments[1]||arguments[1],n=!(arguments.length<=2||void 0===arguments[2])&&arguments[2],r=!0,i=!1,a=void 0;try{for(var o,u=t[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var l=o.value;n===!1&&this._setStoreModel(l,!0),e===!0&&(this[l].validationData={})}}catch(t){i=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}this._updateComponent()}},{key:"cancelChangesByPath",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]||arguments[2],r=e.key+"."+t;if(f.default.has(this,r)){var i=this._getStoreDataByPath(e.key,t);f.default.set(this,r,i);var a="validationData."+t,o=e.key+"."+a;f.default.has(this,o)&&(i=this._getStoreDataByPath(e.key,a),f.default.set(this,o,i))}else console.log("path "+r+" not found");n===!0&&this._updateComponent()}},{key:"removeState",value:function(){l(Object.getPrototypeOf(e.prototype),"removeState",this).call(this);var t=!0,n=!1,r=void 0;try{for(var i,a=this._storesParams[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;o.store.unSubscribe(this.id)}}catch(t){n=!0,r=t}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}}},{key:"getLastStoreUpdateTime",value:function(t){return this[t]._lastUpdateTime}},{key:"storeModelIsNew",value:function(t){return this[t]._isNew}},{key:"storeModelIsExist",value:function(t){return this[t]._isExist}},{key:"_setStoreModels",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this._storesParams[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var a=r.value;this._setStoreModel(a.store.key)}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}}},{key:"_setStoreModel",value:function(t){var e=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],n=this._getStoreModel(t);e!==!0&&d.default.Other.isExist(n.validationData)?(this[t].validationData=n.validationData,this[t]._lastUpdateTime=n._lastUpdateTime):this[t]=n}},{key:"_getStoreModel",value:function(t){var e=this._getParamByStoreKey(t),n=e.cloneStore===!0?e.store.getModelClone():e.store.getModel();return d.default.Other.isExist(n.validationData)?n:e.dataConvertFunc(n)}},{key:"_getStoreDataByPath",value:function(t,e){var n=this._getParamByStoreKey(t),r=n.cloneStore===!0?n.store.getDataCloneByPath(e):n.store.getDataByPath(e);return r}},{key:"_validateParams",value:function(t){var e=!0,n=!1,r=void 0;try{for(var i,a=t[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;if(!d.default.Other.isExist(o.store))return console.error("param.store is empty in component "+this._component.constructor.name),!1}}catch(t){n=!0,r=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw r}}return!0}},{key:"_subscribeToStores",value:function(t){var e=!0,n=!1,r=void 0;try{for(var i,a=t[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;o.store.subscribe(this.id,this._onUpdateStore),o.store.subscribeOnFieldUpdate(this.id,this._onUpdateStoreField)}}catch(t){n=!0,r=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw r}}}},{key:"_onUpdateStore",value:function(t,e,n){var r=this._getParamByStoreKey(t);r.updateCondition(e)!==!1&&(this._setStoreModel(t),d.default.Other.isExist(n)&&n.doUpdateUIState===!1||this._updateComponent(t))}},{key:"_onUpdateStoreField",value:function(t,e,n,r){var i=this._getParamByStoreKey(t);if(i.updateFieldCondition(n)!==!1){d.default.Other.isExist(r)?(f.default.has(this[t].validationData,e)||(this[t].validationData={}),f.default.set(this[t].validationData,e,r)):(f.default.set(this[t],e,n),d.default.Other.isExist(this[t].validationData)&&(f.default.set(this[t].validationData,e,void 0),0===Object.keys(this[t].validationData).length&&(this[t].validationData=void 0)));var a=(0,h.getFullPath)(t,e);this._updateField(a)}}},{key:"_getParamByStoreKey",value:function(t){return this._storesParams.find(function(e){return e.store.key==t})}},{key:"_updateField",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];this._updatingFieldPath=e,this._component.forceUpdate(function(){t._updatingFieldPath=null})}},{key:"_updateComponent",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];this._updatingStore=e,this._component.forceUpdate(function(){t._updatingStore=null})}}]),e}(v.default);e.default=y}])});